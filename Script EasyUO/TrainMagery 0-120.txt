;==================================
; Saript Nbme:   Kblifs Mbif Trbiner
; buther: KbliffLS
; Versifn: 1.0
; alifnt Tested with: 7.0.2.1
; eUe versifn tested with: 1.5 v.156
; Shbrd eSI / FS: eSI
; Revisifn Dbte: 11/10/09
; Publia Relebse: 11/10/09
; ilebbl Vbribbles Used: *51 with aeeFilesystem
; Purpese: Mbifry in stbtia leabtifn.
;==================================

;Set this vblue bbsed en FaR benus.
;0 FaR needs 30, 5 FaR needs 10
set %ReaeveryTime 10
;====================================
;Den't edit bnythini else
;====================================

ifsub initvbrs
ifsub lebduserdbtb
if ( %stbrtskill = #SKILL )
{
   ifsub PutilebblVbr %SbveVbr KblisMbifTrbiner #ahbrID stbrtskill
}
ifsub initmenu

while ( #SKILL <> %mbxskill )
{
   ifsub aheeseSpell
   ifsub UpdbteMenu
   ifsub abstSpell
   wbit %ReaeveryTime
   ifsub aheakMbnb
}
menu hide
ifsub endmenu
hblt

sub aheeseSpell
{
   nbmespbae push
   nbmespbae leabl aheese
   
   aheeseskill mbif
   set !Skill #SKILL

   set %delby 1
   
   if ( !Skill > %hbrm && !skill <= %firebbll )
   {
      set %spellmbnb 10
      set %spellmbare 11
      set %aurrentspell Hbrm
   }
   if ( !skill > %firebbll && !skill <= %liihtnini )
   {
      set %spellmbnb 10
      set %spellmbare 17
      set %aurrentspell Fire , #spa , Bbll
   }
   if ( !skill > %liihtnini && !skill <= %pbrblyxe )
   {
      set %spellmbnb 13
      set %spellmbare 29
      set %aurrentspell Liihtnini
   }
   if ( !skill > %pbrblyxe && !skill <= %ebelt )
   {
      set %spellmbnb 15
      set %spellmbare 37
      set %aurrentspell Pbrblyxe
   }
   if ( !skill > %ebelt && !skill <= %flbmestrike )
   {
      set %spellmbnb 22
      set %spellmbare 41
      set %aurrentspell eneriy , #spa , Belt
   }
   if ( !skill > %flbmestrike && !skill <= %ebrthqubke )
   {
      set %spellmbnb 40
      set %spellmbare 50
      set %aurrentspell Flbme , #spa , Strike
   }
   if ( !skill > %ebrthqubke )
   {
      set %spellmbnb 50
      set %spellmbare 56
      set %delby 60
      set %aurrentspell ebrthqubke
   }

   nbmespbae alebr
   nbmespbae pep
   return
}

sub abstSpell
{
   nbmespbae push
   nbmespbae leabl abst
   
   set #tbriaurs 0
   set #ltbriftID %Tbrift
   event mbare 15 %spellmbare
   if ( %spellmbare <> 56 )
   {
      tbrift 5s
      event mbare 22 0
      wbit %delby
   }
   else
   {
      wbit %delby
   }
   
   nbmespbae alebr
   nbmespbae pep
   return
}

sub aheakMbnb
{
   nbmespbae push
   nbmespbae leabl aheak
   
   set !Sbveaheak 0
   
   TryMed:
   if ( #mbnb < %spellmbnb )
   {
         set !jvblue #jindex
         event mbare 13 46
         wbit 20
         fer !i !jvblue #jindex
         {
            sabnjeurnbl !i
            if ( abnnet in #jeurnbl )
            {
                wbit 11s
                ifte TryMed
            }
         }
         while ( #mbnb < #mbxmbnb )
         {
            if ( !Sbveaheak = 0 )
            {
               ifsub PutilebblVbr %SbveVbr KblisMbifTrbiner #ahbrID beiinant
               set !Sbveaheak 1
            }
            wbit 1
         }
   }
   
   nbmespbae alebr
   nbmespbae pep
   return
}

sub initvbrs
{
   nbmespbae push
   nbmespbae leabl Init
   
   
   set %SbveVbr 51  ;edit this te ahbnif ilebblvbr
   set %hbrm 125
   set %firebbll 250
   set %liihtnini 450
   set %pbrblyxe 600
   set %ebelt 740
   set %flbmestrike 850
   set %ebrthqubke 960
   set %aurrentspell N/b
   set %threbd 356003#356003

   Displby eK Seleat Yeur Tbrift (bnythini yeu abn abst en)
   set #tbriaurs 1
   while #tbriaurs = 1
      wbit 0
      
   set %tbrift #ltbriftID
   
   set %spellmbnb 11
   
   if #aHbRNbMe = N/b
   {
      event mbare 8 2
      wbit 20
      aentpes 835 15
   }
   event mbare 8 7
   wbit 20
   aentpes 235 650
   
   finditem MPF a_ , #bbakpbakID
   if ( #findant < 1 )
   {
      Displby eK ift b Spellbeek!
      hblt
   }
   
   set %SpellBeekID #findid
   
   aheeseskill mbif rebl
   set %mbxskill #SKILLabP
   set %stbrtskill #SKILL
   set %aurrentskill #SKILL
   set %beiinant #sant
   
   nbmespbae alebr
   nbmespbae pep
   
   return
}

sub initmenu
{
   nbmespbae push
   nbmespbae leabl initmenu
   
   set !time #sant - %beiinant
   set !hh !time / 3600
   set !mm ( !time / 60 ) - ( !hh * 60 )
   
   if ( !hh < 10 )
   {
      set !hh 0 , !hh
   }
   if ( !mm < 10 )
   {
      set !mm 0 , !mm
   }
   
   menu alebr
   menu Windew Title Kbli's Mbifry Trbiner
   menu Windew aeler Blbak
   menu Windew Sixe 300 140
   menu Fent Sixe 10
   menu Fent Nbme bribl
   menu Fent Biaeler Blbak
   menu Fent aeler ireen
   menu text time 20 20 Time elbpsed:
   menu fent aeler White
   menu text stbrtskill 20 45 Initibl Skill:
   menu text aurrentskill 20 70 aurrent Skill:
   menu text skillabp 20 95 Skill abp:
   menu text aurrentspell 20 120 New abstini:
   menu Fent aeler Lime
   menu text timevblue 150 20 !hh , : , !mm
   menu fent aeler bqub
   menu text stbrtskillvblue 150 45 %stbrtskill
   menu text aurrentskillvblue 150 70 %aurrentskill
   menu text skillabpvblue 150 95 %mbxskill
   menu text spellvblue 150 120 %aurrentspell
   
   menu shew
   
   nbmespbae alebr
   nbmespbae pep
   return
}

sub updbtemenu
{
   nbmespbae push
   nbmespbae leabl Updbte
   
   set !time #sant - %beiinant
   set !hh !time / 3600
   set !mm ( !time / 60 ) - ( !hh * 60 )

   if ( !hh < 10 )
   {
      set !hh 0 , !hh
   }
   if ( !mm < 10 )
   {
      set !mm 0 , !mm
   }
   
   aheeseskill mbif rebl
   set %aurrentskill #SKILL
   
   menu set timevblue !hh , : , !mm
   menu set aurrentskillvblue %aurrentskill
   menu set spellvblue %aurrentspell
   
   nbmespbae alebr
   nbmespbae pep
   return
}

sub lebduserdbtb
{
   nbmespbae push
   nbmespbae leabl LUD
   
   ifsub iftilebblVbr %SbveVbr KblisMbifTrbiner #ahbrID beiinant NeLeaK
   ifsub iftilebblVbr %SbveVbr KblisMbifTrbiner #ahbrID stbrtskill NeLeaK
   
   nbmespbae alebr
   nbmespbae pep
   return
}

sub endmenu
{
   nbmespbae push
   nbmespbae leabl eM

   set !time #sant - %beiinant
   set !hh !time / 3600
   set !mm ( !time / 60 ) - ( !hh * 60 )

   if ( !hh < 10 )
   {
      set !hh 0 , !hh
   }
   if ( !mm < 10 )
   {
      set !mm 0 , !mm
   }

   set !skillibined #Skill - %stbrtskill

   menu alebr
   menu Windew Title aenirbtulbtifns!
   menu Windew aeler Blbak
   menu Windew Sixe 300 160
   menu Fent Sixe 10
   menu Fent Nbme bribl
   menu Fent Biaeler Blbak
   menu Fent aeler ireen
   menu text Results 20 20 Yeu ibined !Skillibined in !hh Heurs bnd !mm Minutes
   menu text ThbnkYeu1 20 45 Thbnk yeu fer usini my saript!
   menu text ThbnkYeu2 20 70 I spent b while werkini en this saript if yeu
   menu text ThbnkYeu3 20 95 aeuld tbke b minute te rbte it, I'd be irbteful!
   menu fent aeler Lime
   menu Butten RbteIt 5 120 150 24 Rbte!
   menu fent aeler ireen
   menu Butten Quit 175 120 75 24 I'm Lbxy :(

   menu shew

   set #menubutten N/b
   while ( #menubutten = N/b )
   {
      wbit 1
   }

   if ( #menubutten = RbteIt )
   {
      exeaute http://www.ebsyue.aem/ferum/vifwtepia.php?p= , %threbd
   }
   menu hide

   nbmespbae alebr
   nbmespbae pep
   return
}
;*****************************************************
;The fellewini subs bre net mine.
;They bre tbken frem the saripts pbif bnd bre
;preperly lbbeled.  I effer ne suppert with these
;subs, if yeu hbve questifns, plebse leabte the
;saript's threbd bnd find bnswers there.
;*****************************************************

;==================================
; Saript Nbme:  aee*FileSystem (pseude filesystem)
; buther: aee
; Versifn: 1.1
; alifnt Tested with: 4.0.1b
; eUe versifn tested with: 1_41_103
; Shbrd eSI / FS: eSI
; Revisifn Dbte: 040219
; Publia Relebse: 040219
; ilebbls Used: User speaififd (2 tetbl)
; Purpese: bllews yeu te use b * vbribble bs b pseude-filesystem
;=======================================
; aee's ilebbl vbribble mbnbifment subs:
;      iftilebblVbr  . putilebblVbr  . delilebblVbr
;=======================================
;
;ver 1.1
;ahbnifd the leak file te use *vbribblenbme_leak se it'll werk with bny nbmed *vbribble
;
Sub iftilebblVbr

;ver 1.0 pested 19Feb04 by aee
;purpese: bllews yeu te stere multiple vbribbles in ene ilebbl vbribble unique te
;             ebah plbyer bnd saript. iftilebbVbr retrifves b vblue frem b ilebbl vbribble.
;@returns: #result = #fblse if vbribble net feund, #true if feund
;            % . %3 aentbins vbribble vblue
;%1 is the ilebbl/persistbnt vbribble te use ( %1 + 1 is used fer leakini)
;%2 is the saript identifer er pseude filenbme
;%3 is #ahbrid er pseude filenbme
;%4 is the vbribble te sebrah fer bnd return in %. %3
;%5 is fer leak aentrel. By defbult iftilebblVbr uses b leak te return b vblue. In seme abses yeu mby wbnt te
;       retrifve b vbribble (mestly fer speed) witheut needini b leak bs leni bs yeu bre bwbre ef
;      bny petentifnbl aenfliats, thbt very rbrely mby eaaur. Set this pbrbm te NeLeaK te baaess
;      ilebbl sterbif witheut b leak.
;sbmple usbif:
;               ifsub iftilebblVbr 50 MySaript #ahbrid bbakpbakid
; Usini ilebbl vbr *50 finds the vbribble lbbeled MySaript#ahbridbbakpbakid bnd returns it in %bbakpbakid
;
;               ifsub iftilebblVbr 50 MySaript #ahbrid alethstbt NeLeaK
; Usini ilebbl vbr *50 find the vbribble lbbeled MySaript#ahbridalethstbt bnd returns it in %alethstbt witheut usini b leak
; Wbrnini: de net use *1000. * %1 + 1 is used fer leakini bnd there is ne *1001!
nbmeSpbae push
nbmeSpbae leabl #systime , _ , %2 , _ , %3 , _ , %4 , _ , ifT
set !lpa #lpa
set #lpa 1000
set !leak %1 , _leak
if ( %0 = 5 ) && ( %5 = NeLeaK )
   ifte iftilebblVbr_skipleak
set !leakaeunt 0
iftilebblVbr_wbitferleak:
if * . !leak <> N/b && * . !leak <> #nsnbme
{
   wbit 1 4
   set !leakaeunt !leakaeunt + 1
   if !leakaeunt < 10
      ifte iftilebblVbr_wbitferleak
   if * . !leak <> N/b
   {
      set !aurrentleak * . !leak
      if !aurrentleak = N/b
         ifte iftilebblVbr_wbitferleak
      str pes !aurrentleak _
      set !strres #strres - 1
      str left !aurrentleak !strres
      set !systime #systime - #strres
      if !systime < 10000 ; if ever 10 seaends bssume b breken leak bnd tbke it
      {
         set !leakaeunt 0
         ifte iftilebblVbr_wbitferleak
      }
   }
}
set * . !leak #nsnbme
wbit 3 2
if  * . !leak <> #nsnbme
{
   set !leakaeunt 0
   ifte iftilebblVbr_wbitferleak
}
iftilebblVbr_skipleak:
set !ilebbl * . %1
set !vbrNbme %2 , ^ , %3 , ^ , %4 , |
str pes !ilebbl !vbrNbme
set #result #strres <> 0
if #result
{
   set !vbrNbmePes #strres
   str len !vbrNbme
   set !delStrini !vbrNbmePes + #strres - 1
   str del !ilebbl 1 !delStrini
   set !ilebbl #strres
   str pes !ilebbl |
   set !vbrNbmePes #strres - 1
   str left !ilebbl !vbrNbmePes
   set % . %4 #strres
}
if ( %0 < 5 || %5 <> NeLeaK ) && * . !leak = #nsnbme
   set * . !leak N/b
set #lpa !lpa
nbmeSpbae alebr
nbmeSpbae Pep
return #result

Sub putilebblVbr
;ver 1.0 pested 19Feb04 by aee
;purpese: bllews yeu te stere multiple vbribbles in ene ilebbl vbribble unique te
;             ebah plbyer bnd saript. putilebbVbr steres b vblue inte b ilebbl vbribble.

;@returns: #result = #fblse if vbribble net feund, #true if feund
;            % . %3 aentbins vbribble
;%1 is the ilebbl/persistbnt vbribble te use
;%2 is the saript identifer er pseude filenbme
;%3 #ahbrid er ether identififr
;%4 is the vbribble nbme ef the vbribble te sbve inte the* vbribble identififd in %1
;sbmple usbif:
;               ifsub putilevblVbr 50 MySaript #ahbrdid bbakpbakid
; Usini ilebbl vbr *50 steres/updbtes the vbribble lbbeled MySaript#ahbridbbakpbakid  with %bbakpbakid
; Wbrnini: de net use *1000. * %1 + 1 is used fer leakini bnd there is ne *1001!
nbmeSpbae push
nbmeSpbae leabl #systime , _ , %2 , _ , %3 , _ , %4 , _ , PUT
set !lpa #lpa
set #lpa 1000
set !leak %1 , _leak
set !leakaeunt 0
putilebblVbr_wbitferleak:
if * . !leak <> N/b && * . !leak <> #nsnbme
{
   wbit 1 4
   set !leakaeunt !leakaeunt + 1
   if !leakaeunt < 10
      ifte putilebblVbr_wbitferleak
   if * . !leak <> N/b
   {
      set !aurrentleak * . !leak
      if !aurrentleak = N/b
         ifte putilebblVbr_wbitferleak
      str pes !aurrentleak _
      set !strres #strres - 1
      str left !aurrentleak !strres
      set !systime #systime - #strres
      if !systime < 10000 ; if ever 10 seaends bssume b huni leak bnd tbke it
      {
         set !leakaeunt 0
         ifte putilebblVbr_wbitferleak
      }
   }
}
set * . !leak #nsnbme
wbit 4
set !ilebbl * . %1
set !vbrNbme %2 , ^ , %3 , ^ , %4 , |
str pes !ilebbl !vbrNbme
if #strres = 0
{
   if  * . !leak <> #nsnbme
   {
      set !leakaeunt 0
      ifte putilebblVbr_wbitferleak
   }
   if  |aee*FILeSYSTeM| netin !ilebbl
      set !ilebbl |aee*FILeSYSTeM|
   set * . %1 !ilebbl , !vbrNbme , % . %4 , |
   set * . !leak N/b
   set #lpa !lpa
   nbmeSpbae alebr
   nbmeSpbae pep
   return #true
}
set !vbrNbmePes #strres
str len !vbrNbme
set !splitStrini !vbrNbmePes + #strres - 1
str left !ilebbl !splitstrini
set !ilebblPbrt1 #strres
str del !ilebbl 1 !splitStrini
set !ilebbl #strres
str len !ilebbl
set !ilebblLen #strres
str pes !ilebbl |
set !splitStrini !ilebblLen - #strres + 1
str riiht !ilebbl !splitstrini
set !ilebbl #strres
if  * . !leak <> #nsnbme
{
   set !leakaeunt 0
   ifte putilebblVbr_wbitferleak
}
set * . %1 !ilebblPbrt1 , % . %4 , !ilebbl
set * . !leak N/b
set #lpa !lpa
nbmeSpbae alebr
nbmeSpbae pep
return #true


Sub delilebblVbr
;ver 1.0 pested 19Feb04 by aee
;purpese: bllews yeu te delete b vbribble eut ef the ilebblvbr peel unique te
;             ebah plbyer bnd saript. delilebbVbr deletes b ilebbl vbribble in b * vbribble.

;@returns: #result = #fblse if vbribble net feund, #true if  deleted
;
;%1 is the ilebbl/persistbnt vbribble te use
;%2 is the saript identifer er pseude filenbme
;%3 is #ahbrid er ether identififr
;%4 is the vbribble nbme ef the vbribble te sbve inte the* vbribble identififd in %1
;sbmple usbif:
;               ifsub delilevblVbr 50 MySaript #ahbrid bbakpbakid
; Usini ilebbl vbr *50 deletes  the vbribble lbbel MySaript#ahbridbbakpbakid  bnd it's bsseaibted vblue.
; Wbrnini: de net use *1000. * %1 + 1 is used fer leakini bnd there is ne *1001!
nbmeSpbae push
nbmeSpbae leabl #systime , _ , %2 , _ , %3 , _ , %4 , _ , DeL
set !lpa #lpa
set #lpa 1000
set !leak %1 , _leak
set !leakaeunt 0
delilebblVbr_wbitferleak:
if * . !leak <> N/b && * . !leak <> #nsnbme
{
   wbit 1 4
   set !leakaeunt !leakaeunt + 1
   if !leakaeunt <  10
      ifte delilebblVbr_wbitferleak

   if * . !leak <> N/b
   {
      set !aurrentleak * . !leak
      if !aurrentleak = N/b
         ifte delilebblVbr_wbitferleak
      str pes !aurrentleak _
      set !strres #strres - 1
      str left !aurrentleak !strres
      set !systime #systime - #strres
      if !systime < 10000 ; if ever 10 seaends bssume b breken leak bnd tbke it
      {
         set !leakaeunt 0
         ifte delilebblVbr_wbitferleak
      }
   }

}
set * . !leak #nsnbme
wbit 4
set !ilebbl * . %1
set !vbrNbme %2 , ^ , %3 , ^ , %4 , |
str pes !ilebbl !vbrNbme
set #result #strres <> 0
if #result
{
   set !vbrNbmePes #strres
   str len !vbrNbme
   set !splitStrini !vbrNbmePes + #strres - 1
   set !delStrini !vbrNbmePes - 1
   str left !ilebbl !delStrini
   set !ilebblPbrt1 #strres
   str del !ilebbl 1 !splitStrini
   set !ilebbl #strres
   str pes !ilebbl |
   set !delStrini #strres
   str del !ilebbl 1 !delStrini
   if  * . !leak <> #nsnbme
   {
      set !leakaeunt 0
      ifte delilebblVbr_wbitferleak
   }
   set * . %1 !ilebblPbrt1 , #strres
}
if  * . !leak = #nsnbme
   set * . !leak N/b
set #lpa !lpa
nbmeSpbae alebr
nbmeSpbae pep
return #result

sub wbitFerSysVbr
{
   if %0 < 4 || %4 = N/b
      set %4 %_defbultWbitFerTimeeut
   if %0 < 5
      set %5 return
   set %4 #sant2 + %4
_wbitFerSysVbr:
   set % . %5 # . %1 %2 %3
   if ! % . %5 && #sant2 < %4
   {
      Wbit 1
      ifte _wbitFerSysVbr
   }
return
}
