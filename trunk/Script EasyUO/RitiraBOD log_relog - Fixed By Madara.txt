;========================================
; Nome Script: Extra Black&Tailor Bodding
; Autore: TheGod
; Versione: 7.0.2.0
; Client Version: 7.0.22.0
; Versione EasyUO: 1.5 v.236
; Data ultima modifica: 17/02/2013
; Riconoscimenti: Madara, CEO, Jakefm2377, Drael
;==============================================================================================================================
; Caratteristiche:
; 1) Non necessità di rune per prendere i bod; tutto ciò che dovete fare,oltre a impostare quanto richiesto nel menù,è sloggare
;    i pg scelti alla banca di Luna,lo script penserà al resto. ---> NB: Fate partire lo script dalla schermata iniziale di UO.
; 2) Contiene il check per i save e i cleaning.
; 3) Contiene il check per il restart del server; dalle 06:30 fino alle 08:00 non eseguirà nessuna azione e poi riprenderà
;    automaticamente.
; 4) Contiene il check per la connection lost (dopo la quale riloggherà con lo stesso pg per terminare il giro).
; 5) Se trova un pg ancora loggato aspetta 5 minuti e poi rilogga.
; 6) Non riprende con il giro di bod se non siete al main menu (sempre se avete superato l'ora di pausa) così da permettervi di
;    terminare ciò che state facendo in tutta calma.
; 7) E' possibile far smistare i bod all'interno dei book tramite il pulsante Organizza (che,nel secondo menu,entrerà in
;    funzione se lo premete appena starà per sloggare il pg). ---> NB: Lasciando uno dei due campi a N/A non verranno smistati
;    appena starà per sloggare il pg). ---> NB: Lasciando uno dei due campi a N/A non verranno smistati i bod di quel tipo.
;    Inoltre sono necessari due Bulk Order Book (uno chiamato Tailor e l'altro Black).E' possibile sloggare e riloggare per
;    passare i book da un pg all'altro (dopo il display) che avverte della mancanza di bod,per poi riprendere a smistare
;    apremendo il pulsante Continua.Inoltre è possibile premere il pulsante Stop per uscire dalla sub.Il discorso è valido
;    anche per la ricerca dei Bulk Order Book.Ora è possibile ricaricare un nuovo menu con il pulsante Reset.
; 8) Questo è ciò che verrà visualizzato nel menù successivo alle impostazioni:
;    - Quanti bod avete preso (sia da tailor che da black).
;    - Quante giri di bod avete ultimato.
;    - A che ora è partito lo script e quando è stato preso l'ultimo bod (sia da tailor che da black).
;
; DATA 09/02/2013
; Oltre alle classiche caratteristiche ecco le funzionalità aggiuntive:
; 1) Aggiunto due nuovi tipi di spostamento:
;    - RAIL: basta crearsi un rail da CASA a LUNA e viceversa.(Utile per chi abita vicino un tailor).
;    - RUNE: basta inserire la posizione delle rune di CASA e di LUNA che si trova nel vostro Runebook.
; 2) Blocco Connecting, modificate le voci sotto CLIENT nelle impostazioni per attivarlo o disattivarlo(true - false)
;
; ATTENZIONE:
; Alcune cose importanti:
; - Tenere aperto Paperdoll, Backpack, Status, Journal
; - Per usare il metodo RUNE dovete avere almeno 65 pt Chiva o Magery, e Tenere un solo Runebook nel backpack
; - Il fil AssistUO o Client deve trovarsi all'interno della cartella di easyuo
; - Al momento il blocco_conn funziona solo con AssistUO v1.0.7 RC7 Build 2
;==============================================================================================================================
; Edit By Madara
;############# INIZIO IMPOSTAZIONI #################
set %bank_cont_t N/A ; ID Container tailor dentro banca
set %bank_cont_b N/A ; ID Container black dentro la banca
; CLIENT
set %blocco_conn #true ; riapre il client al blocco connecting - #true/#false
set %client AssistUO ; scegliete con che usare il client ("AssistUO" oppure "Client")
; RAIL
set %t_container NEAYJMD ; ID Container Tailor dentro casa
set %b_container KJLKOMD ; ID Container Black dentro casa
set %rail_luna rail_luna.txt ; Nome RAIL da casa a luna bank
set %rail_casa rail_casa.txt ; Nome RAIL da luna a casa bank
set %rail_return N/A ; RAIL di ritorno in caso di connection_lost (potete lasciarla vuota)
; RUNE
set %runa_luna 2 ; Posizione runa per luna bank
set %runa_casa 1 ; Posizione runa per casa
;############## FINE IMPOSTAZIONI ##################


;###################################################
;############ NON MODIFICARE QUI SOTTO #############
;#################################### LPC
set %normal_lpc 10
set %fast_lpc 50000
;################## GUMP INFO
set %connection_lost QEMB
set %quit_gump YesNo_gump
set %bod_gump STM
set %main_gump MainMenu_gump
set %verifying waiting_gump
set %shard WNGD
set %choose_character Login_gump
set %paperdoll paperdoll_gump
set %backpack OHF
;############################### COORDINATES INFO
set %username_x 530
set %username_y 360
set %password_x 530
set %password_y 400
set %world_x 185
set %world_y 430
set %pg_x 370
set %pg_y 140
set %pix_x 440
set %pix_y 185
set %black 524288
set %wrong_gump_x 199
set %wrong_gump_y 254
set %logout_x 986
set %logout_y 523
set %path_x 984
set %path_y 520
set %bod_tailor_x 978
set %bod_tailor_y 525
set %medium_x 978
set %medium_y 520
set %medium_tx 978
set %medium_ty 521
set %medium_tx2 978
set %medium_ty2 523
set %medium_bx 978
set %medium_by 518
set %medium_bx2 978
set %medium_by2 516
set %bod_black_x 978
set %bod_black_y 513
;#################### USING VENDOR
set %npc HS_IS
set %distance 6
set %option 4
;############## MENU INFO
set %bod_tailor 0
set %bod_black 0
set %routine 0
set %last_h_t 00
set %last_m_t 00
set %last_s_t 00
set %last_h_b 00
set %last_m_b 00
set %last_s_b 00
set %connect_time 0
set %need_menu *menu
;################### VARIOUS
set %num_pg N/A
set %RuneBook ZBN
set %book DYM
set %bod EYM
set %t_color 1155
set %b_color 1102
set %wait 10
set %loop_time 0
;################### INITEVENTS
deletejournal
set #lpc %normal_lpc
gosub create_menu
main:
while #contname <> %main_gump
 {
 if #menubutton = CLOSED
  {
  set #menubutton N/A
  halt
  }
 }
wait 1s
if *tailor_1 <> 0 || *black_1 <> 0
 gosub bod 1 *tailor_1 *black_1
if #result = 1
 goto main
while #contname <> %main_gump
 {
 if #menubutton = CLOSED
  {
  set #menubutton N/A
  halt
  }
 }
2_pg:
if *tailor_2 <> 0 || *black_2 <> 0
 gosub bod 2 *tailor_2 *black_2
if #result = 2
 goto 2_pg
while #contname <> %main_gump
 {
 if #menubutton = CLOSED
  {
  set #menubutton N/A
  halt
  }
 }
3_pg:
if *tailor_3 <> 0 || *black_3 <> 0
 gosub bod 3 *tailor_3 *black_3
if #result = 3
 goto 3_pg
while #contname <> %main_gump
 {
 if #menubutton = CLOSED
  {
  set #menubutton N/A
  halt
  }
 }
4_pg:
if *tailor_4 <> 0 || *black_4 <> 0
 gosub bod 4 *tailor_4 *black_4
if #result = 4
 goto 4_pg
while #contname <> %main_gump
 {
 if #menubutton = CLOSED
  {
  set #menubutton N/A
  halt
  }
 }
5_pg:
if *tailor_5 <> 0 || *black_5 <> 0
 gosub bod 5 *tailor_5 *black_5
if #result = 5
 goto 5_pg
while #contname <> %main_gump
 {
 if #menubutton = CLOSED
  {
  set #menubutton N/A
  halt
  }
 }
6_pg:
if *tailor_6 <> 0 || *black_6 <> 0
 gosub bod 6 *tailor_6 *black_6
if #result = 6
 goto 6_pg
while #contname <> %main_gump
 {
 if #menubutton = CLOSED
  {
  set #menubutton N/A
  halt
  }
 }
7_pg:
if *tailor_7 <> 0 || *black_7 <> 0
 gosub bod 7 *tailor_7 *black_7
if #result = 7
 goto 7_pg
while #contname <> %main_gump
 {
 if #menubutton = CLOSED
  {
  set #menubutton N/A
  halt
  }
 }
set %routine ( %routine + 1 )
menu set quanti_giri Routine: %routine
set %ripeti_giro ( #scnt + *rout_x )
while #scnt < %ripeti_giro
 {
 if #menubutton = CLOSED
  {
  set #menubutton N/A
  halt
  }
 }
goto main
;###################################### MENU
sub create_menu
 if %need_menu = N/A
 {
  set *menu_old #false
  set *rout 1
  gosub new_menu
 }
 else
 {
  set *menu_old #true
  set *pass_crypt ***************
  set *how_many_t 0
  set *how_many_b 0
  gosub old_menu
 }
 set #menubutton N/A
 while #menubutton <> START
 {
  menu get check_rail
  set *luna_ck #menures
  menu get check_rune
  set *rune_ck #menures
  if *luna_ck = #true && *rune_ck = #true
  {
   set *luna_ck #false
   set *rune_ck #false
   gosub old_menu
  }
  if #menubutton = START
   break
  if #menubutton = CLOSED
   halt
  if #menubutton = ORGANIZZA
   gosub drag_drop
  if #menubutton = RAIL
   gosub write_rail
  if #menubutton = RESET
  {
   set #menubutton N/A
   set *menu_old #false
   set *rout 1
   set *pass N/A
   gosub new_menu
  }
 }
 set #menubutton N/A
 menu get insert_user
 set *user #menures
 if *menu_old = #false
 {
  menu get insert_pass
  set *pass #menures
 }
 menu get insert_routine
 set *rout #menures
 set *rout_x ( *rout * 60 ) * 60
 menu get time_ck
 set *time_ck #menures
 if *time_ck = #true
 {
  set *time_sec 00
  menu get time_ore
  set *time_ore #menures
  menu get time_min
  set *time_min #menures
  menu font style b
  menu font color red
  menu font size 10
  menu text tailor 80 207 Sto aspettando le *time_ore , #dot , *time_min per iniziare...
  set *temp *time_ore , *time_min , *time_sec
  loop_time:
  if *temp = #time
   break
  else
   goto loop_time
  set *time_ck #false
 }
 menu get reward_ck
 set *reward #menures
 menu get tailor_1
 set *tailor_1 #menures
 menu get tailor_2
 set *tailor_2 #menures
 menu get tailor_3
 set *tailor_3 #menures
 menu get tailor_4
 set *tailor_4 #menures
 menu get tailor_5
 set *tailor_5 #menures
 menu get tailor_6
 set *tailor_6 #menures
 menu get tailor_7
 set *tailor_7 #menures
 menu get black_1
 set *black_1 #menures
 menu get black_2
 set *black_2 #menures
 menu get black_3
 set *black_3 #menures
 menu get black_4
 set *black_4 #menures
 menu get black_5
 set *black_5 #menures
 menu get black_6
 set *black_6 #menures
 menu get black_7
 set *black_7 #menures
 menu getnum how_many_t N/A
 set *how_many_t #menures
 menu getnum how_many_b N/A
 set *how_many_b #menures
 menu clear
 menu window size 230 280
 menu font bgcolor black
 menu font color red
 menu font style b
 menu font size 20
 menu text tag_bod 15 15 Bodding Time!
 menu font color red
 menu font style b
 menu font size 10
 menu text quanti_tailor 15 70 Bod Tailor: %bod_tailor
 menu text quanti_black 15 100 Bod Black: %bod_black
 menu text quanti_giri 15 130 Routine: %routine
 str left #time 2
 set %b_hour #strres
 str mid #time 3 2
 set %b_min #strres
 str right #time 2
 set %b_sec #strres
 menu text partenza 15 160 Partenza: %b_hour , : , %b_min , : , %b_sec
 menu text last_tailor 15 190 Ultimo Tailor: %last_h_t , : , %last_m_t , : , %last_s_t
 menu text last_black 15 220 Ultimo Black: %last_h_b , : , %last_m_b , : , %last_s_b
 menu font color yellow
 menu text connecting 15 250 Blocchi connecting: %connect_time
 set *menu 1
 return
;##################################################################################### NEW MENU
sub new_menu
 menu clear
 menu window size 360 531
 menu window title BOD
 menu window color black
 menu font bgcolor black
 menu font color red
 menu font style b
 menu font size 20
 menu text tag_bod 15 5 Impostazioni
 menu font color yellow
 menu font size 10
 menu text rune 15 40 Come vuoi spostarti?
 menu check check_rail 55 60 100 15 #false
 menu text text_rail 20 60 Bank
 menu check check_rune 225 60 100 15 #true
 menu text text_rune 157 60 Rail/Rune
 menu text time_routine_ore 135 90 ore
 menu text time_routine 15 90 Routine:
 menu edit insert_routine 110 85 20 *rout
 menu text reward 255 90 V-Reward
 menu check reward_ck 323 90 100 15 #false
 menu text username 15 120 Username:
 menu edit insert_user 110 115 150 *user
 menu text password 15 150 Password:
 menu edit insert_pass 110 145 150 *pass
 menu text time_start 15 183 Iniziare ad un'ora pre-stabilita?
 menu edit time_ore 20 205 20 00
 menu text time_space 42 206 :
 menu edit time_min 50 205 20 00
 menu check time_ck 220 183 100 15 #false
 menu text tailor 100 230 Tailor
 menu text black 200 230 Blacksmith
 menu text 1_pg 15 260 1°PG
 menu text 2_pg 15 290 2°PG
 menu text 3_pg 15 320 3°PG
 menu text 4_pg 15 350 4°PG
 menu text 5_pg 15 380 5°PG
 menu text 6_pg 15 410 6°PG
 menu text 7_pg 15 440 7°PG
 menu check tailor_1 110 260 100 15 #false
 menu check tailor_2 110 290 100 15 #false
 menu check tailor_3 110 320 100 15 #false
 menu check tailor_4 110 350 100 15 #false
 menu check tailor_5 110 380 100 15 #false
 menu check tailor_6 110 410 100 15 #false
 menu check tailor_7 110 440 100 15 #false
 menu check black_1 230 260 100 15 #false
 menu check black_2 230 290 100 15 #false
 menu check black_3 230 320 100 15 #false
 menu check black_4 230 350 100 15 #false
 menu check black_5 230 380 100 15 #false
 menu check black_6 230 410 100 15 #false
 menu check black_7 230 440 100 15 #false
 menu font size 13
 menu font color red
 menu button start 245 15 100 30 Inizia
 menu button reset 245 50 100 30 Resetta
 menu button organizza 20 475 140 30 Smista BOD
 menu button rail 200 475 140 30 Crea RAIL
 menu font size 7
 menu font color yellow
 ;menu text black 263 520 By Madara
 menu text black 2 520 IMPORTANTE** , #spc , #spc , Client 7.0.4.0 , #spc , - , #spc , Razor v1.0.13 (Beta)
 menu hideeuo
 menu show
 menu window transparent 80
 set *menu 1
 return
;########################################################################################## OLD MENU
sub old_menu
 menu clear
 menu window size 360 531
 menu window title BOD
 menu window color black
 menu font bgcolor black
 menu font color red
 menu font style b
 menu font size 20
 menu text tag_bod 15 5 Impostazioni
 menu font color yellow
 menu font size 10
 menu text rune 15 40 Come vuoi spostarti?
 menu check check_rail 55 60 100 15 *luna_ck
 menu text text_rail 20 60 Bank
 menu check check_rune 225 60 100 15 *rune_ck
 menu text text_rune 157 60 Rail/Rune
 menu text time_routine_ore 135 90 ore
 menu text time_routine 15 90 Routine:
 menu edit insert_routine 110 85 20 *rout
 menu text reward 255 90 V-Reward
 menu check reward_ck 323 90 100 15 *reward
 menu text username 15 120 Username:
 menu edit insert_user 110 115 150 *user
 menu text password 15 150 Password:
 menu edit insert_pass 110 145 150 *pass_crypt
 menu text time_start 15 183 Iniziare ad un'ora pre-stabilita?
 menu edit time_ore 20 205 20 00
 menu text time_space 42 206 :
 menu edit time_min 50 205 20 00
 menu check time_ck 220 183 100 15 #false
 menu text tailor 100 230 Tailor
 menu text black 200 230 Blacksmith
 menu text 1_pg 15 260 1°PG
 menu text 2_pg 15 290 2°PG
 menu text 3_pg 15 320 3°PG
 menu text 4_pg 15 350 4°PG
 menu text 5_pg 15 380 5°PG
 menu text 6_pg 15 410 6°PG
 menu text 7_pg 15 440 7°PG
 menu check tailor_1 110 260 100 15 *tailor_1
 menu check tailor_2 110 290 100 15 *tailor_2
 menu check tailor_3 110 320 100 15 *tailor_3
 menu check tailor_4 110 350 100 15 *tailor_4
 menu check tailor_5 110 380 100 15 *tailor_5
 menu check tailor_6 110 410 100 15 *tailor_6
 menu check tailor_7 110 440 100 15 *tailor_7
 menu check black_1 230 260 100 15 *black_1
 menu check black_2 230 290 100 15 *black_2
 menu check black_3 230 320 100 15 *black_3
 menu check black_4 230 350 100 15 *black_4
 menu check black_5 230 380 100 15 *black_5
 menu check black_6 230 410 100 15 *black_6
 menu check black_7 230 440 100 15 *black_7
 menu font size 13
 menu font color red
 menu button start 245 15 100 30 Inizia
 menu button reset 245 50 100 30 Resetta
 menu button organizza 20 475 140 30 Smista BOD
 menu button rail 200 475 140 30 Crea RAIL
 menu font size 7
 menu font color yellow
 ;menu text black 263 520 By Madara
 menu text black 2 520 IMPORTANTE** , #spc , #spc , Client 7.0.4.0 , #spc , - , #spc , Razor v1.0.13 (Beta)
 menu hideeuo
 menu show
 menu window transparent 80
 set *menu 1
 return
;########################################################################################## DRAG AND DROP
sub drag_drop

gosub Menu1
set #MENUBUTTON n/a
buttonloop:
set %counter 0
if #menubutton = CLOSED
{
 set #menubutton N/A
 halt
}
if #menuButton <> n/a
   {
   if #menubutton = ItemButton
      {
      gosub itemset
      set #menuButton n/a
      }
   if #menubutton = OutButton
      {
      gosub outset
      set #menuButton n/a
      }
   if #menubutton = intoButton
      {
      gosub intoset
      set #menuButton n/a
      }
   if %itemready = yes && %outready = yes && %inready = yes
         {
         menu Font Size 10
	       menu Font Color Lime
	       menu Button startstopbutton 20 100 171 25 Press to start
         if #menubutton = startstopbutton
            {
            gosub work
            set #menuButton n/a
            }
         }
   }
goto buttonloop

sub itemset
SET #TARGCURS 1
target
repeat
wait 1
until #targCurs = 0
WAIT 5
FINDITEM #LTARGETID G
IF #FINDKIND = 1
  {
  WAIT 5
  set %item #FINDTYPE
  }
FINDITEM #LTARGETID C
IF #FINDKIND = 0
  {
  WAIT 5
  set %item #FINDTYPE
  }
event PROPERTY #ltargetid
set %string #PROPERTY
str pos %string $
if #strres > 13
   set %cut 13
else
    set %cut #strres - 1
str left %string %cut
set %itemname #strres
menu Font Size 8
menu Font Color lime
menu Button ItemButton 132 28 75 20 %itemname
set %itemready yes
return

sub outset
set #targCurs 1
target
repeat
wait 1
until #targCurs = 0
set %outbag #LTARGETID
event PROPERTY #ltargetid
set %string #PROPERTY
str pos %string $
if #strres > 13
   set %cut 13
else
    set %cut #strres - 1
str left %string %cut
set %outbagname #strres
menu Font Size 8
menu Font Color lime
menu Button OutButton 132 52 75 20 %outbagname
set %outready yes
return

sub intoset
set #targCurs 1
target
repeat
wait 1
until #targCurs = 0
set %inbag #LTARGETID
event PROPERTY #ltargetid
set %string #PROPERTY
str pos %string $
if #strres > 13
   set %cut 13
else
    set %cut #strres - 1
str left %string %cut
set %inbagname #strres
menu Font Size 8
menu Font Color lime
menu Button IntoButton 132 76 75 20 %inbagname
set %inready yes
return


sub work
set #menuButton n/a
menu Font Size 12
menu Font Color Lime
menu Font Align Center
menu Button startstopbutton 20 100 171 25 Cambia Container Bod
move:
if #menuButton = startstopbutton
   return
finditem %item c_ , %outbag
if #FINDKIND <> -1
  {
   exevent drag #FINDID #findstack
  wait %wait
  Exevent Dropc %inbag
  wait %wait
  set %counter %counter + 1
  menu Font Size 8
  menu Font Color yellow
  menu Button startstopbutton 20 100 171 25 Item Spostati %counter , #dot , #dot , #dot , Press to Stop
  goto move
  }
return


sub Menu1
	menu Clear
	menu Window Title BOD
	menu Window Color Black
	menu Window Size 217 127
	menu Font Transparent #true
	menu Font Align Right
	menu Font Name MS Sans Serif
	menu Font Size 9
	menu Font Style
	menu Font Color Lime
	menu Font Transparent #false
	menu Font Align Center
	menu Font BGColor Black
	menu Text introLabel 8 12 Premi i pulsanti per settare poi premi start
	menu Font Size 10
	menu Font Color Yellow
	menu Text ITEMLabel 8 32 Item
	menu Font Size 8
	menu Font Align Left
	menu Text OutLabel 8 56 Container Bod
	menu Text IntoLabel 8 80 Bulk Order Book
	menu Font Color Red
	menu Button ItemButton 132 28 75 20 Press to set
	menu Button OutButton 132 52 75 20 Press to set
	menu Button IntoButton 132 76 75 20 Press to set
	menu Show
return
;##################################################################################################### BOD
sub bod
 gosub menu_bod
 gosub login %1
 while #contname <> %paperdoll
  event macro 8 1
 if *reward = #true
 {
  wait 10
  click 295 105
 }
 gosub connection_lost
 if #result = 1
 {
  if *rune_ck = #true
  {
   if #skill < 650
   {
    set %num_pg %1
    return 1
   }
   if #skill >= 650
    return 1
  }
  return 1
 }
 gosub save_clean
 if *luna_ck = #true
  goto jump_luna
 if *rune_ck = #true
 {
  chooseskill mage
  if #skill >= 650
   set %Recall Magery
  if #skill < 650
  {
   chooseskill chiv
   if #skill >= 650
    set %Recall Chiva
   if #skill < 650
    goto else_luna
  }
  if #skill >= 650
  {
   while #contkind <> %backpack
    event macro 8 7
   set %pos_x #charposx
   set %pos_y #charposy
   set %runa %runa_luna
   loop_runaluna:
   gosub recall
   set %time ( #scnt + 5 )
   while %pos_x = #charposx && %pos_y = #charposy
   {
    if #scnt >= %time ; riprova recall
    {
     wait 10
     goto loop_runaluna
    }
   }
   wait 10
  }
 }
 else
 {
  else_luna:
  if %rail_luna = N/A
  {
   display ok Non hai settato la variabile "%Rail_luna"
   halt
  }
  set %rail %rail_luna
  gosub rail
  if #result = 1
   return %1
 }
 gosub menu_bod
 jump_luna:
 gosub connection_lost
 if #result = 1
 {
  if *rune_ck = #true
  {
   if #skill < 650
   {
    set %num_pg %1
    return 1
   }
   if #skill >= 650
    return 1
  }
  return 1
 }
 while #charposx <> %path_x || #charposy <> %path_y
  event pathfind %path_x %path_y
 wait 10
 while #charposx <> %medium_x || #charposy <> %medium_y
  event pathfind %medium_x %medium_y
 wait 10
 while #charposx <> %medium_tx || #charposy <> %medium_ty
  event pathfind %medium_tx %medium_ty
 wait 10
 ignoreitem #charid
 if %2 = -1
  gosub tailor
 if #result = 1
  return %1
 if *rune_ck = #true
 {
  if #skill >= 650
  {
   if %3 <> -1
    goto jump
  }
 }
 while #charposx <> %medium_tx2 || #charposy <> %medium_ty2
  event pathfind %medium_tx2 %medium_ty2
 wait 10
 while #charposx <> %medium_x || #charposy <> %medium_y
 {
  event pathfind %medium_x %medium_y
  scanjournal 1
  if Can't_get_there in #journal
   event macro 12 0
  deletejournal
 }
 wait 10
 while #charposx <> %medium_bx || #charposy <> %medium_by
  event pathfind %medium_bx %medium_by
 wait 10
 if %3 = -1
  gosub black
 if #result = 1
  return %1
 if *rune_ck = #true
 {
  if #skill >= 650
   goto jump
 }
 while #charposx <> %medium_bx2 || #charposy <> %medium_by2
  event pathfind %medium_bx2 %medium_by2
 wait 10
 while #charposx <> %medium_x || #charposy <> %medium_y
 {
  event pathfind %medium_x %medium_y
  scanjournal 1
  if Can't_get_there in #journal
   event macro 12 0
  deletejournal
 }
 wait 10
 to_bank:
 while #charposx <> %path_x || #charposy <> %path_y
  event pathfind %path_x %path_y
 wait 10
 jump:
 if *rune_ck = #true
 {
  if #skill < 650
   goto else_casa
  if #skill >= 650
  {
   set %pos_x1 #charposx
   set %pos_y1 #charposy
   set %runa %runa_casa
   loop_runacasa:
   gosub recall
   set %time ( #scnt + 5 )
   while %pos_x1 = #charposx && %pos_y1 = #charposy
   {
    if #scnt >= %time ; riprova recall
    {
     wait 10
     goto loop_runacasa
    }
   }
   wait 10
   while #charposx <> %pos_x || #charposy <> %pos_y
    event pathfind %pos_x %pos_y
  }
 }
 else
 {
  else_casa:
  if %rail_casa = N/A
  {
   display ok Non hai settato la variabile "%Rail_casa"
   halt
  }
  set %rail %rail_casa
  gosub rail
  if #result = 1
   return %1
 }
 gosub menu_bod
 while #contkind <> %backpack
  event macro 8 7
 if *rune_ck = #true
 {
  loop_bod:
  finditem %bod C_ , #backpackid
  if #findcol = %b_color
  {
   exevent drag #findid
   wait 10
   exevent dropc %b_container
   wait 10
  }
  if #findcol = %t_color
  {
   exevent drag #findid
   wait 10
   exevent dropc %t_container
   wait 10
  }
  if #findid = X
   break
  else
   goto loop_bod
 }
 if *luna_ck = #true
 {
  while #contid = #backpackid
   event macro 1 0 bank
  bank_bod:
  finditem %bod C_ , #backpackid
  if #findcol = %b_color
  {
   exevent drag #findid
   wait 10
   exevent dropc %bank_cont_b
   wait 10
  }
  if #findcol = %t_color
  {
   exevent drag #findid
   wait 10
   exevent dropc %bank_cont_t
   wait 10
  }
  if #findid = X
   break
  else
   goto bank_bod
 }
 gosub logout
 if #result = 1
  return %1
 return
;###################################################### LOGIN
sub login
 enter:
 gosub restart_time
 set %x ( #contposx + %username_x )
 set %y ( #contposy + %username_y )
 while #contname <> %main_gump
  {
   if #contname = %choose_character
    break
  }
 click %x %y
 wait 10
 for %i 1 16
  key back
 wait 10
 msg *user
 wait 10
 set %x ( #contposx + %password_x )
 set %y ( #contposy + %password_y )
 while #contname <> %main_gump
  {
   if #contname = %choose_character
    break
  }
 click %x %y
 wait 10
 for %i 1 16
  key back
 wait 10
 msg *pass
 msg $
 set %time ( #scnt + 60 )
 while #contkind <> %shard
 {
  if #scnt >= %time
  {
   set %x ( #contposx + %wrong_gump_x )
   set %y ( #contposy + %wrong_gump_y )
   click %x %y
   wait 3s
   goto enter
  }
 }
 set %x ( #contposx + %world_x )
 set %y ( #contposy + %world_y )
 wait 10
 click %x %y
 set %time ( #scnt + 60 )
 while #contname <> %choose_character && #contname = %verifying
 {
  if #scnt >= %time && %blocco_conn = #true
  {
   execute %client
   while #clicnt <> 2
    {
    }
   wait 10
   uoxl swap
   wait 3s
   execute cmd /c taskkill /f /fi "WINDOWTITLE ne Ultima Online" /fi "WINDOWTITLE ne Euox" /fi "WINDOWTITLE ne BOD" /fi "WINDOWTITLE ne AssistUO v1.0.7 RC7 Build 2"
   set %connect_time ( %connect_time + 1 )
   wait 10s ; aspetta finisce splash screen
   goto enter
  }
 }
 if %1 = 1
  {
  set %x ( #contposx + %pg_x )
  set %y ( #contposy + %pg_y )
  wait 10
  click %x %y
  wait 10
  click %x %y d mc
  }
 if %1 = 2
  {
  set %x ( #contposx + %pg_x )
  set %y ( #contposy + %pg_y + 40 )
  wait 10
  click %x %y
  wait 10
  click %x %y d mc
  }
 if %1 = 3
  {
  set %x ( #contposx + %pg_x )
  set %y ( #contposy + %pg_y + 80 )
  wait 10
  click %x %y
  wait 10
  click %x %y d mc
  }
 if %1 = 4
  {
  set %x ( #contposx + %pg_x )
  set %y ( #contposy + %pg_y + 120 )
  wait 10
  click %x %y
  wait 10
  click %x %y d mc
  }
 if %1 = 5
  {
  set %x ( #contposx + %pg_x )
  set %y ( #contposy + %pg_y + 160 )
  wait 10
  click %x %y
  wait 10
  click %x %y d mc
  }
 if %1 = 6
  {
  set %x ( #contposx + %pg_x )
  set %y ( #contposy + %pg_y + 200 )
  wait 10
  click %x %y
  wait 10
  click %x %y d mc
  }
 if %1 = 7
  {
  set %x ( #contposx + %pg_x )
  set %y ( #contposy + %pg_y + 240 )
  wait 10
  click %x %y
  wait 10
  click %x %y d mc
  }
 wait 1s
 set %time ( #scnt + 60 )
 while #charname = N/A
  {
  event macro 8 2
  if #scnt >= %time
   {
   set %x ( #contposx + %wrong_gump_x )
   set %y ( #contposy + %wrong_gump_y )
   click %x %y
   wait 2s
   goto enter
   }
  savepix %pix_x %pix_y 1
  if #pixcol = %black
   {
   set %x ( #contposx + %wrong_gump_x )
   set %y ( #contposy + %wrong_gump_y )
   click %x %y
   wait 360s
   goto enter
   }
  }
return
;############################################ SERVER RESTART
sub restart_time
 str left #time 2
 wait 5
 set %hour #strres
 str mid #time 3 2
 wait 5
 set %min #strres
 if %hour = 06 && %min >= 30
  {
  if #charname <> N/A
   gosub logout
  if #result = 1
   return 1
  while 1 = 1
   {
   str left #time 2
   set %hour #strres
   str mid #time 3 2
   set %min #strres
   if %hour = 08 && %min >= 00
    return
   }
  }
 return
;############################# CONNECTION LOST
sub connection_lost
 if #contkind = %connection_lost
  {
  set %x ( #contposx + 100 )
  set %y ( #contposy + 120 )
  click %x %y mc
  wait 10
  while #contname <> %main_gump
   {
   }
  wait 10
  return 1
  }
return
;############################### SAVE AND CLEAN
sub save_clean
 set #lpc %fast_lpc
 for %l 1 10
  {
  scanjournal %l
  if World_save in #journal && #jcolor = 53
   {
   set #lpc %normal_lpc
   return
   }
  if saving in #journal && #jcolor = 53
   {
   while 1 = 1
    {
    if World_save in #sysmsg
     {
     set #lpc %normal_lpc
     return
     }
    }
   }
  if The_world_will in #journal && #jcolor = 53
   {
   while 1 = 1
    {
    if saving in #sysmsg
     {
     while 1 = 1
      {
      if World_save in #sysmsg
       {
       set #lpc %normal_lpc
       return
       }
      }
     }
    }
   }
  if Cleaning in #journal && #jcolor = 53
   {
   while 1 = 1
    {
    if Cleaned in #sysmsg
     {
     set #lpc %normal_lpc
     return
     }
    }
   }
  if Cleaned in #journal && #jcolor = 53
   {
   set #lpc %normal_lpc
   return
   }
  }
 set #lpc %normal_lpc
return
;########################################################################### LOGOUT
sub logout
 gosub connection_lost
 if #result = 1
 {
  if *rune_ck = #true
  {
   if #skill < 650
   {
    set %num_pg %1
    return 1
   }
   if #skill >= 650
    return 1
  }
  return 1
 }
 gosub save_clean
 while #contname <> %paperdoll && #contid <> #charid
  {
  event macro 8 1
  wait 10
  }
 wait 10
 set %x ( #contposx + 215 )
 set %y ( #contposy + 110 )
 click %x %y
 wait 10
 while #contname <> %quit_gump
  {
  }
 wait 10
 set %x ( #contposx + 119 )
 set %y ( #contposy + 84 )
 click %x %y
 wait 10
 while #contname <> %main_gump
  wait 5
 return
;############################################## BOD TAILOR
sub tailor
 key F11
 wait 10
 while #charposx <> %bod_tailor_x || #charposy <> %bod_tailor_y
 {
  event pathfind %bod_tailor_x %bod_tailor_y
  scanjournal 1
  if Can't_get_there in #journal
   event macro 12 0
  deletejournal
 }
 wait 10
 if #contkind = IMM && #contname = generic_gump
 {
  set %x ( #contposx + 5 )
  set %y ( #contposy + 5 )
  wait 10
  click %x %y r
  wait 10
 }
 find_tailor:
 gosub connection_lost
 if #result = 1
 {
  if *rune_ck = #true
  {
   if #skill < 650
   {
    set %num_pg %1
    return 1
   }
   if #skill >= 650
    return 1
  }
  return 1
 }
 gosub save_clean
 finditem %npc
 wait 10
 if #findrep <> 7
  {
  ignoreitem #findid
  goto find_tailor
  }
 event property #findid
 if Tailor notin #property && Weaver notin #property
  {
  ignoreitem #findid
  goto find_tailor
  }
 ignoreitem reset
 set #ltargetid #findid
 deletejournal
 wait_for_tailor:
 gosub restart_time
 gosub connection_lost
 if #result = 1
 {
  if *rune_ck = #true
  {
   if #skill < 650
   {
    set %num_pg %1
    return 1
   }
   if #skill >= 650
    return 1
  }
  return 1
 }
 gosub save_clean
 finditem #ltargetid
 wait 5
 if #finddist > %distance
  goto wait_for_tailor
 set #lpc %fast_lpc
 while #contkind <> %bod_gump
  {
  exevent popup #ltargetid %option
  wait 10
  for %i 1 10
   {
   scanjournal %i
   if An_offer_may_be_available_in_about in #journal
    {
    set #lpc %normal_lpc
    deletejournal
    wait 60s
    goto wait_for_tailor
    }
   }
  }
 set #lpc %normal_lpc
 set %x ( #contposx + 115 )
 set %y ( #contposy + 250 )
 wait 10
 click %x %y
 wait 10
 set %bod_tailor ( %bod_tailor + 1 )
 menu set quanti_tailor Bod Tailor: %bod_tailor
 str left #time 2
 wait 5
 set %last_h_t #strres
 str mid #time 3 2
 wait 5
 set %last_m_t #strres
 str right #time 2
 wait 5
 set %last_s_t #strres
 menu set last_tailor Ultimo Tailor: %last_h_t , : , %last_m_t , : , %last_s_t
 return
;############################################################################# BOD BLACK
sub black
 key F11
 wait 10
 while #charposx <> %bod_black_x || #charposy <> %bod_black_y
 {
  event pathfind %bod_black_x %bod_black_y
  scanjournal 1
  if Can't_get_there in #journal
   event macro 12 0
  deletejournal
 }
 wait 10
 if #contkind = IMM && #contname = generic_gump
 {
  set %x ( #contposx + 5 )
  set %y ( #contposy + 5 )
  wait 10
  click %x %y r
  wait 10
 }
 find_black:
 gosub connection_lost
 if #result = 1
 {
  if *rune_ck = #true
  {
   if #skill < 650
   {
    set %num_pg %1
    return 1
   }
   if #skill >= 650
    return 1
  }
  return 1
 }
 gosub save_clean
 finditem %npc
 wait 10
 if #findrep <> 7
  {
  ignoreitem #findid
  goto find_black
  }
 event property #findid
 if Blacksmith notin #property
  {
  ignoreitem #findid
  goto find_black
  }
 if Guildmaster in #property
  {
  ignoreitem #findid
  goto find_black
  }
 ignoreitem reset
 set #ltargetid #findid
 deletejournal
 wait_for_black:
 gosub restart_time
 gosub connection_lost
 if #result = 1
 {
  if *rune_ck = #true
  {
   if #skill < 650
   {
    set %num_pg %1
    return 1
   }
   if #skill >= 650
    return 1
  }
  return 1
 }
 gosub save_clean
 finditem #ltargetid
 wait 5
 if #finddist > %distance
  goto wait_for_black
 set #lpc %fast_lpc
 while #contkind <> %bod_gump
  {
  exevent popup #ltargetid %option
  wait 10
  for %i 1 10
   {
   scanjournal %i
   if An_offer_may_be_available_in_about in #journal
    {
    set #lpc %normal_lpc
    deletejournal
    wait 60s
    goto wait_for_black
    }
   }
  }
 set #lpc %normal_lpc
 set %x ( #contposx + 115 )
 set %y ( #contposy + 250 )
 wait 10
 click %x %y
 wait 10
 set %bod_black ( %bod_black + 1 )
 menu set quanti_black Bod Black: %bod_black
 str left #time 2
 wait 5
 set %last_h_b #strres
 str mid #time 3 2
 wait 5
 set %last_m_b #strres
 str right #time 2
 wait 5
 set %last_s_b #strres
 wait 5
 menu set last_black Ultimo Black: %last_h_b , : , %last_m_b , : , %last_s_b
 return
;####################################################################### CEO RAIL READ
sub rail
return_rail:

initevents
set %version 1.0

set *500 Waiting
set *501 start
set *502 %rail
set *503 1
set *504 run
set *505 run
set %last504 *504
set %endspot 72
set %count 0
gosub InitMenu
%endspot
set #menubutton N/A
gosub DisplayStatus yellow

WaitForStart:
wait 1s
  if *502 = N/A || *501 <> START
    goto WaitForStart
menu delete t1
menu text t1 10 5 Railfile: *502
set *500 Initializing
gosub DisplayStatus blue
set %endspot N/A
set %count 0
call *502
if %endspot = N/A
{
  menu delete t1
  menu delete t2
  menu text t1 10 5 Railfile: *502 , #spc , (INVALID)
  set *500 halt
  menu font bgcolor red
  gosub DisplayStatus black
  halt
}
set %last502 *502
if *504 = WALK
{
  gosub WalkOn
  goto MainLoop
}
gosub RunOn
if %num_pg = %1
{
 set %num_pg #true
 set %rail %rail_return
 goto return_rail
}
MainLoop:
for %i 1 %endspot
 {
  gosub connection_lost
  if #result = 1
  {
   if *rune_ck = #true
   {
    if #skill < 650
    {
     set %num_pg %1
     return 1
    }
    if #skill >= 650
     return 1
   }
   return 1
  }
  gosub save_clean
  set %enemyfound #false
  finditem %ENEMYTYPES G_ , %SEARCHRANGE
  if #findkind <> -1
    gosub EnemyFound
  if *501 = PAUSE || #menubutton = PAUSE
    gosub RailPause
  if *501 = STOP || #menubutton = CLOSED
  {
    event macro 32 0
    set #menubutton N/A
    halt
  }
  if %last504 <> *504 && ! %enemyfound
    gosub SetPace
  set %oldcharposx #charposx
  set %oldcharposy #charposy
  set %x %x . %i
  set %y %y . %i
  set %z %z . %i
  menu delete d1
  menu text d1 280 5 %i
  set *500 moving
  gosub DisplayStatus green
  if %num_pg = #true
   move %x %y 0 10s
  else
  {
   if #charposx <> %x || #charposy <> %y
   {
    gosub connection_lost
    if #result = 1
    {
     if *rune_ck = #true
     {
      if #skill < 650
      {
       set %num_pg %1
       return 1
      }
      if #skill >= 650
       return 1
     }
     return 1
    }
    gosub save_clean
    move %x %y 0 4s
    if #charposx <> %x || #charposy <> %y
     event PathFind %x %y %z
   }
  }
 }
set %count %count + 1
if %count < *503 || *503 = -1
  goto MainLoop
if %last502 <> *502
  goto WaitForStart
set *501 N/A
set *500 done
event macro 32 0
if %num_pg = #true
{
 set %num_pg N/A
 set %rail %rail_luna
 goto return_rail
}
return
gosub DisplayStatus white
goto WaitForStart

sub EnemyFound
set %enemyfound #true
set *500 enemy
gosub DisplayStatus red
if *505 = WAIT
{
  gosub EnemyWait
  return
}
if *505 = PAUSE
{
  gosub EnemyPause
  return
}
if *504 = RUN || %last504 = RUN
  return
gosub RunOn
set %last504 run
menu delete d2
menu font bgcolor red
menu font color white
menu font size 9
menu text d2 225 20 Running
menu font bgcolor black
menu font color red
menu font size 10
return

sub EnemyPause
menu font bgcolor red
gosub DisplayStatus black
menu font bgcolor black
menu delete pause
menu button resume 10 45  80 25 RESUME
set #menubutton N/A
enemy1:
wait 1s
if #menubutton = RESUME
  goto resume1
if *501 <> RESUME
  goto enemy1
resume1:
menu delete resume
menu button pause 10 45  80 25 PAUSE
set *501 N/A
set #menubutton N/A
return

sub EnemyWait
menu font bgcolor red
gosub DisplayStatus black
menu font bgcolor black
menu delete pause
menu button resume 10 45  80 25 RESUME
set #menubutton N/A
enemy2:
wait 1s
if #menubutton = RESUME
  goto resume2
finditem %ENEMYTYPES G_ , %SEARCHRANGE
if #findkind <> -1
  goto enemy2
resume2:
menu delete resume
menu button pause 10 45  80 25 PAUSE
set #menubutton N/A
return

sub RailPause
set *500 paused
menu delete pause
menu button resume 10 45  80 25 RESUME
set #menubutton N/A
gosub DisplayStatus white
wait2:
wait 1s
if #menubutton = RESUME
  goto resume3
if *501 <> RESUME
  goto wait2
resume3:
menu delete resume
menu button pause 10 45  80 25 PAUSE
set *501 N/A
set #menubutton N/A
return

Sub RunON

event macro 32 0
wait 10 10
if now_on IN #SYSMSG
  return
event macro 32 0
return

Sub WalkOn

event macro 32 0
wait 10 10
if now_off IN #SYSMSG
  return
event macro 32 0
return

sub InitMenu
menu clear
menu window size 325 75
menu window title BOD
menu window color black
menu font bgcolor BLACK
menu font color red
menu text t1 10 5 Railfile: None
menu text t2 225 5 Railspot:
menu text t3 10 25 Status:
menu button pause 10 45  80 25 PAUSE
menu show
menu hideeuo
return

sub DisplayStatus
menu font color %1
menu delete status
menu text status 55 25 *500
menu font color red
return

sub DisplayWalkRun
menu delete d2
menu font color blue
menu font size 9
if *504 = WALK
{
  menu text d2 225 20 Walking
  menu font color red
  menu font size 10
  return
}
menu text d2 225 20 Running
menu font color red
menu font size 10
return

sub SetPace
set %last504 *504
if *504 = WALK
{
  gosub WalkOn
  Gosub DisplayWalkRun
  return
}
gosub RunOn
Gosub DisplayWalkRun
return
;####################################################################### CEO RAIL WRITE
sub write_rail
initevents

set %ztolerance 3
set %dtolerance 4
set %targetx_text ltargetx
set %targety_text ltargety
set %targetz_text ltargetz
set %filename rail_luna.txt

set %cmd cmd

set %version 1.3a
set %debug #false
set %totalspots 0
set %totalltargets 0
set %testrail #false
if EXEC notin #opts
{
  display ok In order to save the rail file you must have $"Allow Execute" on.
+ Enable this option$from the Easyuo menu:$$Options>Configuration>Allow Execute$$Halting...
  halt
}
gosub InitWriteMenu
set #menubutton N/A
Mainloop:
wait 5
if #menubutton <> N/A
  gosub #menubutton
if *500 = waiting && ! %testrail
{
  menu font bgcolor silver
  menu font color black
  menu button TestRail 200 5 60 20  Test Rail
  menu font bgcolor black
  menu font color red
  set %testrail #true
}
gosub DisplayCords
goto Mainloop

sub TestRail
set *502 railspots.txt
set *503 1
set *504 run
set *501 start
set #menubutton N/A
return

sub Write
show menu
menu delete record
set #menubutton N/A
menu delete write
menu font bgcolor blue
menu font color white
menu text status 55 5 Writing File
menu font bgcolor black
menu font color red
str mid #date 3 2
set %date #strres
str right #date 2
set %date %date , / , #strres
str left #date 2
set %date %date , / , #strres
execute %cmd /c echo #smc , * Created with CEOAutoRailWriter on , #spc , %date , #spc , * > %filename
execute %cmd /c echo #smc , #spc >> %filename
execute %cmd /c echo set % , endspot , #spc , %totalspots >> %filename
menu text hs 10 30 Saving Spot:
menu font color white
for %i 1 %totalspots
{
  menu delete ss
  menu text ss 85 30 %i
  wait 1
  execute %cmd /c echo set % , X , %i , #spc , %railspotx . %i >> %filename
  execute %cmd /c echo set % , Y , %i , #spc , %railspoty . %i >> %filename
  execute %cmd /c echo set % , Z , %i , #spc , %railspotz . %i >> %filename
  if %target . %i = #true
  {
    execute %cmd /c echo set % , %targetx_text , %i , #spc , %ltargetx . %i >> %filename
    execute %cmd /c echo set % , %targety_text , %i , #spc , %ltargety . %i >> %filename
    execute %cmd /c echo set % , %targetz_text , %i , #spc , %ltargetz . %i >> %filename
    execute %cmd /c echo set % , ltargetkind , %i , #spc , %ltargetkind . %i >> %filename
    execute %cmd /c echo set % , ltargettile , %i , #spc , %ltargettile . %i >> %filename

  }
}
menu font bgcolor silver
menu font color black
menu button Record 10 150 50 20  Record
menu font bgcolor black
menu font color red
set %totalspots 0
menu delete rx
menu delete ry
menu delete rz
menu delete ss
menu delete hs
menu delete fh
gosub DisplayTotalSpots
menu delete status
return

sub Record
show menu
set %lpc #lpc
set #lpc 1000
for %i 1 %totalspots
{
  set %ltargetx . %i n/a
}
set #lpc %lpc
set %totalspots 1
set %totalltargets 0
gosub WalkOn
gosub DisplayTotalSpots
gosub RecordSpot
menu delete Record
menu font bgcolor silver
menu font color black
menu button Stop 10 150 50 20  Stop
menu button LTARGET 110 150 50 20  Ltarget
menu font bgcolor black
menu delete recording
menu font bgcolor red
menu font color white
menu text status 55 5 Recording
menu font bgcolor black
menu font color red
menu text ath 10 30 Auto Timer:
set %recording #true
set #menubutton N/A
Record1:
show menu
if #menubutton = ltarget
{
  if %lastpos <> %lastrailspot
  {
       set %totalspots %totalspots + 1
      gosub DisplayTotalSpots
       gosub RecordSpot
      gosub DisplayCords
  }
  gosub record_ltarget
  gosub DisplayTotalSpots
}
if #menubutton <> N/A
{
  gosub #menubutton
  if ! %recording
  {
    menu delete ltarget
    return
  }
}
wait 5
if %lastpos <> %lastrailspot
{
  set %timetowrite %lastmoved - #scnt
  menu delete ttw
  if %timetowrite <= 5
  {
    menu font color yellow
    menu text ttw 75 30 %timetowrite
    menu font color red
    if %timetowrite <= 0
    {
       set %totalspots %totalspots + 1
      gosub DisplayTotalSpots
       gosub RecordSpot
    }
  }
}
gosub DisplayCords
if %record_spot
{
   set %totalspots %totalspots + 1
  gosub DisplayTotalSpots
   gosub RecordSpot
}
goto Record1

return

sub RecordSpot
set %lastspotx #charposx
set %lastspoty #charposy
set %lastspotz #charposz
set %railspotx . %totalspots %lastspotx
set %railspoty . %totalspots %lastspoty
set %railspotz . %totalspots %lastspotz
gosub DisplayRecordedSpot
set %lastrailspot %lastspotx , _ , %lastspoty , _ , %lastspotz
set %lastpos %lastrailspot
set %lastmoved #scnt + 5
menu delete ttw
return

sub DisplayRecordedSpot
menu font align right
menu font color white
menu delete rx
menu text rx 135 70 %lastspotx
menu delete ry
menu text ry 175 70 %lastspoty
menu delete rz
menu text rz 215 70 %lastspotz
menu font color red
menu font align left
return

sub stop
menu delete Stop
menu font bgcolor silver
menu font color black
menu button Record 10 150 50 20  Record
set #menubutton N/A
menu delete status
menu delete ath
menu delete ttw
set %recording #false
if %totalspots > 1
  menu button Write 60 150 50 20  Write
menu font bgcolor black
menu font color lime
gosub RunON
return

sub InitWriteMenu
menu clear
menu font alight left
menu window size 270 200
menu window title BOD
menu window color black
menu font bgcolor BLACK
menu font color red
menu show
menu font size 9
menu text s 10 5 Status:
menu text fnameheader 5 180 Filename:
menu font size 8
menu font color white
menu edit fname 70 175 130 %filename
menu font size 9
menu font color red
menu text h1x 130 35 X
menu text h1y 170 35 Y
menu text h1z 210 35 Z
menu text h1 10 50 Current Position:
menu text h5 10 70 Last Recorded:
menu text h4 10 85 Total Railspots:
menu text h4 145 85 Total # , LTargets:
gosub DisplayTotalSpots
menu font align left
menu font style b
menu font color yellow
menu text hh 5 100 Rail Parameters :
menu font style n
menu font color red
menu text h2 10 115 Max distance between spots:
menu text h3 10 130 Z tolerance:
menu font color yellow
menu text t2 175 115 %dtolerance
menu text t3 80 130 %ztolerance
menu font color red
gosub displayCords
menu font bgcolor silver
menu font color black
menu button Record 10 150 50 20  Record
menu button getfname 201 178 30 20 upd
if *500 = waiting
{
  menu button TestRail 200 5 60 20  Test Rail
  set %testrail #true
}
menu font bgcolor black
menu font color red
set #menubutton N/A
menu delete total
menu font color lime
if ! %debug
  menu hideeuo
return


sub DisplayTotalSpots
menu font align right
menu font color white
menu delete tspots
menu delete tltargets
menu text tspots 120 85 %totalspots
menu text tltargets 255 84 %totalltargets
menu font align left
menu font color red
return

sub DisplayCords
set %record_spot #false
if #charposx , _ , #charposy , _ , #charposz = %lastpos
  return
menu font align right
menu font color lime
X:
if %lastposx = #charposx
  goto Y
menu delete x
menu text x 135 50 #charposx
set %dif abs ( %lastspotx - #charposx )
if %dif > %dtolerance
  set %record_spot #true
set %lastposx #charposx
Y:
if %lastposy = #charposy
  goto Z
set %dif abs ( %lastspoty - #charposy )
if %dif > %dtolerance
  set %record_spot #true
menu delete y
menu text y 175 50 #charposy
set %lastposy #charposy
Z:
if #lastposz = #charposz
  goto DC_End
set %dif abs ( %lastspotz - #charposz )
if %dif > %ztolerance
  set %record_spot #true
menu delete z
menu text z 215 50 #charposz
set %lastposx #charposz

DC_End:
set %lastpos #charposx , _ , #charposy , _ , #charposz
menu font align left
menu font color red
set %lastmoved #scnt + 7
menu delete ttw
return

Sub WalkOn

event macro 32 0
wait 10 10
if now_off IN #SYSMSG
  return
event macro 32 0
return

Sub RunON

event macro 32 0
wait 10 10
if now_on IN #SYSMSG
  return
event macro 32 0
return

sub closed
if ! %debug
  stop
return

sub record_ltarget
event macro 13 14
targetloop:
  if #targcurs = 1
    goto targetloop
if %ltargetx . %totalspots <> n/a
{
  set %totalspots %totalspots + 1
  gosub DisplayTotalSpots
  gosub RecordSpot
}
set %ltargetx . %totalspots #ltargetx
set %ltargety . %totalspots #ltargety
set %ltargetz . %totalspots #ltargetz
set %ltargetkind . %totalspots #ltargetkind
set %ltargettile . %totalspots #ltargettile
set %totalltargets %totalltargets + 1
set %target . %totalspots #true
set #menubutton n/a
return

sub getfname
menu get fname
if #menuRes <> %filename
{
  set %filename #menuRes
  menu font color white
  menu font size 8
  menu edit fname 70 175 130 %filename
  menu font color lime
  menu font size 9
}
set #menubutton n/a
return
;################################################################## RECALL
Sub recall
GoSub OpenBook
GoSub Pagina
GoSub PaginaSet
GoSub Skill
Wait 10
Return

Sub OpenBook
OpenBook:
finditem %RuneBook C_ , #backpackid
set #lobjectid #findid
wait 1s
while #contname <> generic_gump
 event macro 17
Return

Sub Pagina
If %runa <= 16
{
  Set %ClickX #ContPosX + 415
  Set %ClickY #ContPosY + 195
}
If %runa <= 14
{
  Set %ClickX #ContPosX + 380
  Set %ClickY #ContPosY + 195
}
If %runa <= 12
{
  Set %ClickX #ContPosX + 345
  Set %ClickY #ContPosY + 195
}
If %runa <= 10
{
  Set %ClickX #ContPosX + 310
  Set %ClickY #ContPosY + 195
}
If %runa <= 8
{
  Set %ClickX #ContPosX + 245
  Set %ClickY #ContPosY + 195
}
If %runa <= 6
{
  Set %ClickX #ContPosX + 210
  Set %ClickY #ContPosY + 195
}
If %runa <= 4
{
  Set %ClickX #ContPosX + 175
  Set %ClickY #ContPosY + 195
}
If %runa <= 2
{
  Set %ClickX #ContPosX + 140
  Set %ClickY #ContPosY + 195
}
Click %ClickX %ClickY x 2
Return

Sub PaginaSet
If %Runa = 1
{
  Set %Pagina 1
  return
}
If %Runa in 1_3_5_7_9_11_13_15
{
  Set %Pagina 1
}
If %Runa in 2_4_6_8_10_12_14_16
{
  Set %Pagina 2
}
Return

Sub Skill
If %Pagina = 1
{
  If %Recall = Magery
  {
    Set %ClickX #ContPosX + 140
    Set %ClickY #ContPosY + 145
  }
  If %Recall = Chiva
  {
    Set %ClickX #ContPosX + 140
    Set %ClickY #ContPosY + 180
  }
}
If %Pagina = 2
{
  If %Recall = Magery
  {
    Set %ClickX #ContPosX + 300
    Set %ClickY #ContPosY + 145
  }
  If %Recall = Chiva
  {
    Set %ClickX #ContPosX + 300
    Set %ClickY #ContPosY + 180
  }
}
Click %ClickX %ClickY x 2
Return
;################################################################## MENU BOD
sub menu_bod
 menu clear
 menu window size 230 280
 menu font bgcolor black
 menu font color red
 menu font style b
 menu font size 20
 menu text tag_bod 15 15 Bodding Time!
 menu font color red
 menu font style b
 menu font size 10
 menu text quanti_tailor 15 70 Bod Tailor: %bod_tailor
 menu text quanti_black 15 100 Bod Black: %bod_black
 menu text quanti_giri 15 130 Routine: %routine
 menu text partenza 15 160 Partenza: %b_hour , : , %b_min , : , %b_sec
 menu text last_tailor 15 190 Ultimo Tailor: %last_h_t , : , %last_m_t , : , %last_s_t
 menu text last_black 15 220 Ultimo Black: %last_h_b , : , %last_m_b , : , %last_s_b
 menu font color yellow
 menu text connecting 15 250 Blocchi connecting: %connect_time
return
